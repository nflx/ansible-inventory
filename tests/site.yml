---

- name: "Test partial matcher"
  hosts: stoprod-pres02
  tasks:
    - name: "Check group membership for stoprod-pres02 (1/2)"
      debug: msg="{{ group_names }}"
      failed_when: "'{{ item }}' not in group_names"
      with_items:
        - www
        - site
        - sto
        - prod
        - pres
        - site-www
    - name: "Check group membership for stoprod-pres02 (2/2)"
      debug: msg="{{ group_names }}"
      failed_when: "'{{ item }}' in group_names"
      with_items:
        - docker
        - app
        - ext
        - int
        - lon
        - site-docker

- name: "Test vars"
  hosts: lon
  tasks:
    - name: "Check 'search' and website for london site"
      debug: msg={{ search }}
      failed_when: "search != 'lon.mysite.ltd'"


- name: "Test tags"
  hosts: app
  tasks:
    - name: "Make sure that stoext-docker01 belongs to the tag app"
      debug: msg={{ inventory_hostname }}
      failed_when: "inventory_hostname != 'stoext-docker01'"

- name: "Test full hostname matches"
  hosts: stoint-docker01
  tasks:
    - name: "Test full hostname matcher"
      debug: msg="{{ inventory_hostname }}"
      failed_when: "'internt' not in group_names"

- name: "Test includes"
  hosts: nyctest-docker01
  tasks:
    - name: "Make sure that the include works"
      debug: msg="{{ inventory_hostname }}"
      failed_when: "'nyctest' not in group_names"
    - name: "Test var includes (1/2)"
      debug: msg="{{ foo }}"
      failed_when: "foo == '1'"
    - name: "Test var includes (2/2)"
      debug: msg="{{ bar }}"
      failed_when: "bar is not defined"

- hosts: site:&pres
  tasks:
    - name: "Check group hierarchy"
      debug: msg={{ website }}
      failed_when: "website == 'mysite.ltd'"

- hosts: all
  tasks:
    - name: "Make sure that the group 'oin' is missing"
      debug: msg={{ inventory_hostname }}
      failed_when: "'oin' in group_names"

- hosts: stoint-docker02
  tasks:
    - name: "Test inline hostvars"
      debug: msg={{ baz }}
      failed_when: "baz is not defined"
